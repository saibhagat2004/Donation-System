<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation System Blockchain Explorer</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Donation System Blockchain Explorer</h1>
    
    <div class="connection-status">
      <span id="connection-indicator" class="indicator offline"></span>
      <span id="connection-text">Disconnected</span>
      <button id="connect-wallet">Connect to Ganache</button>
    </div>
    
    <div class="card">
      <h2>Contract Information</h2>
      <div class="info-row">
        <label>Contract Address:</label>
        <span id="contract-address">Not deployed yet</span>
        <button id="set-contract-btn" class="small-btn">Set Contract Address</button>
      </div>
      <div class="info-row">
        <label>Owner Address:</label>
        <span id="owner-address">Not available</span>
      </div>
      <div class="info-row">
        <label>Total Donations:</label>
        <span id="total-donations">0</span>
      </div>
      <div class="info-row">
        <label>Funding Pool:</label>
        <span id="funding-pool">0</span>
      </div>
    </div>

    <div class="card">
      <h2>NGO Data</h2>
      <div class="input-group">
        <input type="text" id="ngo-id-input" placeholder="Enter NGO ID" value="NGO-123">
        <button id="fetch-ngo-data">Fetch Data</button>
      </div>
      <div id="ngo-data" class="data-section">
        <div class="info-row">
          <label>Total Received:</label>
          <span id="ngo-total-received">0</span>
        </div>
        <div class="info-row">
          <label>Total Spent:</label>
          <span id="ngo-total-spent">0</span>
        </div>
        <div class="info-row">
          <label>Current Balance:</label>
          <span id="ngo-balance">0</span>
        </div>
        <div class="info-row">
          <label>Incoming Transactions:</label>
          <span id="ngo-incoming-count">0</span>
        </div>
        <div class="info-row">
          <label>Outgoing Transactions:</label>
          <span id="ngo-outgoing-count">0</span>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Active NGOs</h2>
      <button id="fetch-active-ngos">Fetch Active NGOs</button>
      <div id="active-ngos-list" class="data-list"></div>
    </div>

    <div class="card">
      <h2>Record Donation</h2>
      <div class="form-group">
        <input type="text" id="donation-ngo-id" placeholder="NGO ID" value="NGO-123">
        <input type="text" id="donation-donor-id" placeholder="Donor ID" value="DONOR1">
        <input type="text" id="donation-cause" placeholder="Cause" value="Education">
        <input type="number" id="donation-amount" placeholder="Amount (in rupees)" value="1000">
        <button id="record-donation">Record Donation</button>
      </div>
      <div id="donation-result" class="result"></div>
    </div>

    <div class="card">
      <h2>Record Spending</h2>
      <div class="form-group">
        <input type="text" id="spending-ngo-id" placeholder="NGO ID" value="NGO-123">
        <input type="text" id="spending-receiver-id" placeholder="Receiver ID" value="VENDOR1">
        <input type="text" id="spending-cause" placeholder="Cause" value="School Supplies">
        <input type="number" id="spending-amount" placeholder="Amount (in rupees)" value="500">
        <input type="text" id="spending-receipt-hash" placeholder="Receipt Hash" value="RECEIPT-123">
        <button id="record-spending">Record Spending</button>
      </div>
      <div id="spending-result" class="result"></div>
    </div>

    <div class="card">
      <h2>Transactions</h2>
      <div class="tabs">
        <button class="tab-btn active" data-tab="incoming">Incoming</button>
        <button class="tab-btn" data-tab="outgoing">Outgoing</button>
      </div>
      <div id="transactions-incoming" class="tab-content active">
        <table id="incoming-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>NGO ID</th>
              <th>Donor ID</th>
              <th>Cause</th>
              <th>Amount</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button id="load-more-incoming">Load More</button>
      </div>
      <div id="transactions-outgoing" class="tab-content">
        <table id="outgoing-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>NGO ID</th>
              <th>Receiver ID</th>
              <th>Cause</th>
              <th>Amount</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button id="load-more-outgoing">Load More</button>
      </div>
    </div>
  </div>

  <!-- Import ethers.js v6 from unpkg (more reliable) -->
  <script src="https://unpkg.com/ethers@6.10.0/dist/ethers.umd.js"></script>
  <!-- Import ABI definition -->
  <script src="contract-abi.js"></script>
  <!-- Import our app -->
  <script src="app.js"></script>
</body>
</html>